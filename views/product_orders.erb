<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <div>Data last updated: <span class="last-updated-time" data-utc-time="<%= @last_updated %>"><%= @last_updated %></span></div>
  <%= @clear_cache_button %>
</div>

<h1>Orders for <%= @product_name %> since 2024-09-22</h1>

<% if @orders.empty? %>
  <p>No orders found for this product since 2024-09-22.</p>
<% else %>
  <% puts "Debug: Product ID is #{@product_id} (#{@product_id.class})" %>
  <% puts "Debug: Before sorting, first few variants: #{@orders.take(5).map { |o| o['variant'] }}" %>
  <% if @product_id == "1581" %>
    <% @orders = @orders.sort_by { |order| order['variant'] || '' } %>
    <% puts "Debug: Sorting applied for product 1581" %>
  <% else %>
    <% puts "Debug: Sorting not applied (product ID is not 1581)" %>
  <% end %>
  <% puts "Debug: After potential sorting, first few variants: #{@orders.take(5).map { |o| o['variant'] }}" %>

  <table>
    <thead>
      <tr>
        <th>Order #</th>
        <th>Date</th>
        <th>Customer</th>
        <th>Status</th>
        <th>Variant</th>
        <th>Quantity</th>
      </tr>
    </thead>
    <tbody>
      <% total_quantity = 0 %>
      <% @orders.each do |order| %>
        <tr>
          <td><%= order['id'] %></td>
          <td><%= DateTime.parse(order['date']).strftime('%Y-%m-%d %H:%M:%S') %></td>
          <td><%= order['customer']['name'] %> (<%= order['customer']['email'] %>)</td>
          <td><%= order['status'] %></td>
          <td><%= order['variant'] || 'N/A' %></td>
          <td><%= order['quantity'] %></td>
        </tr>
        <% total_quantity += order['quantity'].to_i %>
      <% end %>
      <tr>
        <td colspan="5"><strong>Total</strong></td>
        <td><strong><%= total_quantity %></strong></td>
      </tr>
    </tbody>
  </table>
<% end %>
